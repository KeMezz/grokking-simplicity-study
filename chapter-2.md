## 토니 피자에 오신 것을 환영합니다.

챕터 2에서는 토니 피자라는 로봇 피자 가게 시나리오를 세워, 이 책의 두 가지 파트에 대해 간략히 설명한다.

### 파트 1: 액션과 계산, 데이터

- 액션 : 반죽 펴기, 피자 배달, 재료 주문 등
- 계산 : 조리법에 나온 것을 두 배로 만들기, 쇼핑 목록 결정 등
- 데이터 : 고객 주문, 영수증, 조리법

### 변경 가능성에 따라 코드 나누기

#### 계층화 설계 맛보기

사업이 성장하면서 소프트웨어도 사업에 맞춰 달라져야 한다. 먼저 변경 가능성에 따라 코드를 나눠보려고 한다. 위쪽으로 갈수록 자주 바뀌는 코드가 있고 아래쪽으로 갈수록 자주 바뀌지 않는 코드가 있는 그림을 그려보고자 한다.

| 피자 주방 레이어                                        | 창고 레이어                                               | 메인 레이어   |
| :------------------------------------------------------ | :-------------------------------------------------------- | :------------ |
| **이번 주 메뉴**<br />- 이번 주 특별 메뉴를 위한 조리법 | **이번 주 사야 할 것**<br />-재료를 어디서 구입할 지 결정 | 비즈니스 규칙 |
| **피자 만들기**<br />-조리법 순서                       | **재료 목록**<br />- 재료 목록에 대한 동작                | 도메인 규칙   |
| **자바스크립트**<br />- 객체<br />- 배열                | **자바스크립트**<br />- 객체<br />- 숫자                  | 기술 스택     |

가장 분명한 것은 자바스크립트 언어 자체이다. 언어는 잘 바뀌지 않으므로 배열이나 객체 같은 언어의 기능은 그림의 가장 아래에 위치한다. 그리고 가운데에는 바뀔 수도 있지만 자주 바뀌지는 않는 피자 조리에 대한 코드를 두고, 가장 위에는 '이번 주 메뉴'와 같이 자주 바뀌는 사업적인 내용을 둘 수 있을 것이다.

이렇게 그림을 그리고 나면 각 계층은 그 아래에 있는 계층을 기반으로 만들어진다는 것을 알 수 있다. 그래서 각 계층에 있는 코드는 더 안정적인 기반 위에 작성할 수 있다. 이런 구조로 소프트웨어를 만들면 코드를 쉽게 변경할 수 있다. 가장 위에 있는 코드는 의존성이 거의 없기 대문에 쉽게 바꿀 수 있고 아래에 있는 코드들은 의존성이 많아 바꾸기 어렵지만 자주 바뀌지는 않는다.

함수형 프로그래머는 이 아키텍쳐 패턴이 계층을 만들기 때문에 계층형 설계(stratified design)라고 부른다. 계층형 설계는 일반적으로 비즈니스 규칙, 도메인 규칙, 기술 스택 계층으로 나눈다. 계층형 설계로 만든 코드는 테스트, 재사용, 유지보수가 쉽다.

### 파트 2: 일급 추상

#### 타임라인 다이어그램

> 주문 접수 → 반죽 만들기 → 반죽 펴기 → 소스 만들기 → 소스 뿌리기 → 치즈 갈기 → 치즈 뿌리기 → 오븐에 넣기 → 10분 기다리기 → 서빙

타임라인 다이어그램을 사용하면 액션이 시간 순서에 따라 어떻게 실행되는지 볼 수 있다. 일방향의 업무를 단순히 여러 로봇이 나눠서 한다고 해서 실행 시간이 줄어들기는 힘들다. (순차적인 프로그램을 분산 시스템으로 바꾸는 것은 어렵다.) 타임라인을 서로 맞추지 않은 분산 시스템은 예측 불가능한 순서로 실행된다.

1. 기본적으로 타임라인은 서로 순서를 맞추지 않는다.
2. 액션이 실행되는 시간은 중요하지 않다.
3. 드물지만 타이밍이 어긋나는 경우는 실제 일어난다.
4. 타임라인 다이어그램으로 시스템의 문제를 알 수 있다.

### 타임라인 커팅

타임라인 커팅은 고차 동작으로 구현한다. 각 타임라인은 독립적으로 동작하고 작업이 완료되면 다른 타임라인 끝나기를 기다리기 때문에 어떤 타임라인이 먼저 끝나고 무관해진다.

1. 타임라인 커팅으로 서로 다른 작업들을 쉽게 이해할 수 있다.
2. 타임라인 다이어그램을 사용하면 시간에 따라 진행하는 작업을 쉽게 이해할 수 있다.
3. 타임라인 다이어그램은 유연하다.
